# Plan-pomogator — Формат планов разработки

## Цель правила

Это правило задаёт **единый формат планов разработки**. Если пользователь просит план (или включён Plan mode) — план **обязан** содержать секции ниже и завершаться **непустой** таблицей **File Changes** (что именно будет создано/изменено/удалено и почему).

## Источник требований и копипаст-шаблон

- Спецификация требований к формату планов: `.dev-pomogator/tools/plan-pomogator/requirements.md`
- Копипаст-шаблон плана: `.dev-pomogator/tools/plan-pomogator/template.md`
- **Specs Management**: `.claude/rules/pomogator/specs-management.md` (structure `.specs/`, scripts `.dev-pomogator/tools/specs-generator/`)

> Примечание (render-safe): плейсхолдеры вида `<роль>` могут интерпретироваться как HTML-теги и пропадать в рендере. Используй `{роль}` / `{цель}` / `{ценность}`.

## Когда применять полный формат плана

- Полный формат плана обязателен, если:
  - пользователь явно просит план/спеку/roadmap/таски; или
  - задача нетривиальная (несколько компонентов/файлов/шагов); или
  - активен Plan mode.
- Если вопрос тривиальный (1 шаг, 1 файл, без архитектурных решений) — отвечай напрямую, **не раздувая план**.

## Уточняющие вопросы

- Если ответы критичны для архитектуры/объёма — задай 1–3 уточняющих вопроса.
- Если можно принять разумный дефолт — зафиксируй его в плане как **Assumption** и попроси подтвердить.

## Обязательная структура плана (шаблон)

План должен быть в Markdown и содержать секции **в этом порядке**:

1. **User Stories**
   - Список user stories в формате "Как {роль}, я хочу {цель}, чтобы {ценность}".

2. **Use Cases**
   - Основные сценарии использования (happy path + ключевые edge cases).

3. **Requirements**
   - **FR (Functional Requirements)**: что система должна делать.
   - **Acceptance Criteria (EARS)**: для ключевых FR добавляй критерии в формате:
     - WHEN [event] THEN [system] SHALL [response]
     - IF [precondition] THEN [system] SHALL [response]
     - WHEN [event] AND [condition] THEN [system] SHALL [response]
   - **NFR (Non-Functional Requirements)**: безопасность, производительность, совместимость, эксплуатация, UX и т.д.
   - **Минимальные категории NFR** (если не применимо — явно писать `N/A`):
     - Performance
     - Security
     - Reliability
     - Usability
   - **Assumptions**: явная секция допущений (может быть `N/A`).
   - **Risks** (опционально): риски, breaking changes, внешние зависимости (может быть `N/A`).
   - **Out of Scope** (опционально): что явно НЕ входит в этот план (может быть `N/A`).
   - FR/AC/Use Cases заполняются **доменным содержанием** из контекста задачи и источников требований.

4. **Implementation Plan**
   - Пошаговый план работ (достаточно конкретный, чтобы исполнять "механически").
   - Если план зависит от изучения кода/файлов — явно указать, какие файлы будут просмотрены и зачем.
   - Явно фиксируй **Leverage / Code reuse**: что переиспользуем/расширяем (пути к существующим файлам/классам/функциям), прежде чем предлагать создавать новое.

5. **Todos**
   - Список задач с уникальными идентификаторами в `kebab-case`.
   - У каждой задачи должны быть:
     - `id`
     - `description`
     - `dependencies` (если есть)
   - `description` и `dependencies` должны быть **вложенными строками** (с отступом).
   - **Atomic Task Requirements (обязательно)**:
     - 1–3 файла на задачу
     - 15–30 минут на задачу (ориентир)
     - 1 проверяемый outcome
   - В описании каждой задачи обязательно указывать:
     - **files**: пути + действия (`create/edit/delete/rename/move/replace`)
     - **Requirements refs**: ссылки на требования из секции Requirements (например `_Requirements: FR-1, NFR-Security-2_`)
     - **Leverage** (если применимо): `_Leverage: path/to/file1, path/to/file2_`

6. **Definition of Done (DoD)**
   - Критерии готовности: реализация соответствует Requirements/Use Cases, обновлены конфиги/документация при необходимости, нет утечек секретов, выполнены проверки/тест-план (в рамках правил репозитория).
   - **Verification Plan**:
     - **Automated Tests**: точные команды, которые будут запущены
     - **Manual Verification**: шаги ручной проверки (если применимо)

7. **File Changes (Plan Output) — ОБЯЗАТЕЛЬНО В САМОМ КОНЦЕ**
   - В конце плана должна быть таблица со **всеми файлами**, которые планируется:
     - `create` / `edit` / `delete` / `rename` / `move` / `replace`
   - Таблица **НЕ может быть пустой**: минимум 1 строка данных (кроме заголовка).
   - Минимальные колонки таблицы:
     - `Path`
     - `Action`
     - `Reason`
   - `Path` — только относительный путь в репозитории (без абсолютных путей вида `D:\...`).
   - Если путь неизвестен — укажи `TBD` и добавь шаг в Implementation Plan на уточнение/поиск.

Пример (корректно):
```markdown
## File Changes
| Path | Action | Reason |
|------|--------|--------|
| `.dev-pomogator/tools/plan-pomogator/requirements.md` | create | Зафиксировать требования к формату планов с примерами good/bad. |
```

Пример (некорректно — пустая таблица):
```markdown
## File Changes
| Path | Action | Reason |
|------|--------|--------|
```

## Валидация плана (ручная)

- Перед завершением плана запусти валидатор структуры:
  - `npx tsx .dev-pomogator/tools/plan-pomogator/validate-plan.ts <path-to-plan.md>`
- Валидатор проверяет **формат и структуру**, но не оценивает доменную корректность.

## Запреты и ограничения

- НЕ вставляй в планы/примеры секреты (логины, пароли, токены).
- Не предлагай отключать фичи/тесты/ставить ignore вместо исправления.
- Следуй существующим правилам репозитория (TDD, fail-fast, без моков для E2E и т.п.).
