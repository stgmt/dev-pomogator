---
name: csharp-assertion-patterns
description: Полный список assertion паттернов в C# тестах
alwaysApply: false
globs:
  - "**/*.cs"
  - "**/csharp-parser.ts"
---

# C# Assertion Patterns

При валидации C# тестов учитывай ВСЕ формы assertions, не только `Assert.*`.

## Полный список паттернов

### Стандартные assertions

```csharp
Assert.True(condition);
Assert.Equal(expected, actual);
result.Should().BeTrue();           // FluentAssertions
result.ShouldBe(expected);          // Shouldly
```

### Conditional throws (assertion pattern!)

```csharp
// ✅ Это assertion — throw при невыполнении условия
if (result == null)
{
    throw new InvalidOperationException("Result cannot be null");
}

// ✅ Однострочный вариант
if (!isValid) throw new ArgumentException("Invalid state");

// ✅ Null-coalescing throw
var value = result ?? throw new InvalidOperationException("No result");
```

### Delegation to assertion methods

```csharp
// ✅ Делегирование — assertion в другом методе
[Then(@"result contains items")]
public void ThenResultContainsItems()
{
    ThenResultContainsItems(); // Вызов assertion метода
    VerifyResult();            // Validation метода
    AssertItemsExist();        // Assert метода
}
```

### Playwright assertions

```csharp
// ✅ Implicit assertions — бросают exception при неудаче
await page.WaitForURLAsync("https://example.com");
await locator.WaitForSelectorAsync(options);
await Expect(locator).ToBeVisibleAsync();
```

## Regex паттерны

```typescript
const CSHARP_ASSERTION_PATTERNS = [
    /\bAssert\.\w+\s*\(/,
    /\.Should\(\)\.\w+/,
    /\.ShouldBe\w*\s*\(/,
    /\bExpect\s*\(/,
    
    // Conditional throws
    /if\s*\([^)]+\)\s*\{[\s\S]*?throw\s+new\s+(InvalidOperationException|ArgumentException)/,
    /throw\s+new\s+InvalidOperationException\s*\(/,
    
    // Delegation
    /\b(Then|Assert|Verify|Check|Validate)\w+\s*\([^)]*\)\s*;/,
    
    // Playwright
    /\.WaitFor(URL|Selector|Function|LoadState)Async\s*\(/,
    /\.Expect\w*Async\s*\(/,
];
```

## Чеклист

- [ ] Проверил conditional throws?
- [ ] Проверил delegation to assertion methods?
- [ ] Проверил Playwright implicit assertions?
- [ ] Добавил новые паттерны в regex?
